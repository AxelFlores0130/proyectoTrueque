{"ast":null,"code":"import { io } from \"socket.io-client\";\nimport { Subject } from \"rxjs\";\nimport { environment } from \"../../environments/environment\"; // ðŸ‘ˆ IMPORTANTE\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./auth.service\";\nexport let ChatService = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class ChatService {\n    constructor(auth) {\n      this.auth = auth;\n      this.mensajes$ = new Subject();\n      // ðŸ‘‡ Base del backend sin \"/api\" (funciona en local y en producciÃ³n)\n      this.socketUrl = environment.apiUrl.replace(\"/api\", \"\");\n    }\n    ensureSocket() {\n      if (this.socket) return;\n      const token = this.auth.getToken(); // desde tu AuthService\n      this.socket = io(this.socketUrl, {\n        transports: [\"websocket\"],\n        query: {\n          token\n        }\n        // Si en algÃºn momento cambias el path de socket.io en el backend,\n        // aquÃ­ podrÃ­as agregar: path: \"/socket.io\"\n      });\n      this.socket.on(\"mensaje_recibido\", msg => {\n        this.mensajes$.next(msg);\n      });\n    }\n    unirseIntercambio(id_intercambio) {\n      this.ensureSocket();\n      const token = this.auth.getToken();\n      this.socket?.emit(\"join_intercambio\", {\n        id_intercambio,\n        token\n      });\n    }\n    salirIntercambio(id_intercambio) {\n      this.socket?.emit(\"leave_intercambio\", {\n        id_intercambio\n      });\n    }\n    enviarTexto(id_intercambio, contenido) {\n      const token = this.auth.getToken();\n      this.socket?.emit(\"nuevo_mensaje\", {\n        token,\n        id_intercambio,\n        tipo: \"texto\",\n        contenido\n      });\n    }\n    enviarUbicacion(id_intercambio, lat, lng) {\n      const token = this.auth.getToken();\n      this.socket?.emit(\"nuevo_mensaje\", {\n        token,\n        id_intercambio,\n        tipo: \"ubicacion\",\n        lat,\n        lng\n      });\n    }\n    onMensaje() {\n      return this.mensajes$.asObservable();\n    }\n    desconectar() {\n      this.socket?.disconnect();\n      this.socket = undefined;\n    }\n    static #_ = _staticBlock = () => (this.Éµfac = function ChatService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || ChatService)(i0.ÉµÉµinject(i1.AuthService));\n    }, this.Éµprov = /*@__PURE__*/i0.ÉµÉµdefineInjectable({\n      token: ChatService,\n      factory: ChatService.Éµfac,\n      providedIn: \"root\"\n    }));\n  }\n  _staticBlock();\n  return ChatService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}