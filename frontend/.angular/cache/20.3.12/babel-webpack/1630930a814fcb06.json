{"ast":null,"code":"import { HttpHeaders } from \"@angular/common/http\";\nimport { environment } from \"../../environments/environment\";\nimport { tap } from \"rxjs/operators\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let AuthService = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class AuthService {\n    constructor(http) {\n      this.http = http;\n      this.API = environment.apiUrl;\n    }\n    // LOGIN: recibe un solo objeto { correo, contrasena }\n    login(payload) {\n      const body = {\n        correo: (payload.correo || \"\").toLowerCase(),\n        contrasena: payload.contrasena\n      };\n      return this.http.post(`${this.API}/auth/login`, body).pipe(tap(res => {\n        // Soportar varias formas de respuesta por si acaso\n        const token = res?.token || res?.access_token || res?.jwt || null;\n        const usuario = res?.usuario || res?.user || res?.datos || null;\n        if (token && usuario) {\n          this.setSession(token, usuario);\n        } else {\n          console.warn('Respuesta de login sin token/usuario esperado:', res);\n        }\n      }));\n    }\n    // REGISTRO\n    register(nombre, correo, telefono, contrasena, rol = \"cliente\") {\n      const body = {\n        nombre_completo: nombre,\n        correo: (correo || \"\").toLowerCase(),\n        telefono: telefono || \"\",\n        contrasena,\n        rol,\n        verificado: 1\n      };\n      return this.http.post(`${this.API}/auth/register`, body);\n    }\n    // SESIÓN\n    setSession(token, usuario) {\n      localStorage.setItem(\"token\", token);\n      localStorage.setItem(\"user\", JSON.stringify(usuario));\n    }\n    clearSession() {\n      localStorage.removeItem(\"token\");\n      localStorage.removeItem(\"user\");\n      sessionStorage.removeItem(\"token\");\n      sessionStorage.removeItem(\"user\");\n    }\n    getToken() {\n      return localStorage.getItem(\"token\");\n    }\n    getUser() {\n      const raw = localStorage.getItem(\"user\");\n      try {\n        return raw ? JSON.parse(raw) : null;\n      } catch {\n        return null;\n      }\n    }\n    getUserId() {\n      const user = this.getUser();\n      if (!user) return null;\n      // Ajusta estos nombres según cómo venga del backend\n      // (seguramente es id_usuario)\n      return user.id_usuario ??\n      // lo más probable\n      user.id ??\n      // por si viene como id\n      null;\n    }\n    isAuth() {\n      return !!this.getToken();\n    }\n    logout() {\n      this.clearSession();\n    }\n    authHeaders() {\n      let headers = new HttpHeaders({\n        \"ngsw-bypass\": \"true\"\n      });\n      const token = this.getToken();\n      if (token) {\n        headers = headers.set(\"Authorization\", `Bearer ${token}`);\n      }\n      return headers;\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function AuthService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AuthService)(i0.ɵɵinject(i1.HttpClient));\n    }, this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: \"root\"\n    }));\n  }\n  _staticBlock();\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}